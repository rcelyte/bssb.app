{% extends "_base.twig" %}

{% set tab = "home" %}

{% block main %}
<main role="main" class="container-fluid">
    <div class="main-page">

        <h1>Beat Saber Server Browser</h1>
        <p class="lead">Beat Saber multiplayer mod that adds a Server Browser to the Online menu, making it easy to share and join multiplayer games.</p>

        {% if not isFiltered %}
            <div id="mod-cards" class="mod-cards" style="display: none;">
                <div id="mod-card-pc" class="card" style="width: 375px;">
                    <a class="close mod-card-close" title="Dismiss promo card"><i class="mdi mdi-close"></i></a>
                    <img src="/static/stuff/browser_v3.png" class="card-img-top"/>
                    <div class="card-body">
                        <h5 class="card-title">Download the PC mod</h5>
                        <ul>
                            <li>Add your games to the server browser</li>
                            <li>Browse and join from within the game</li>
                        </ul>
                        <a class="btn btn-success" target="_blank" href="https://github.com/roydejong/BeatSaberServerBrowser/releases/latest">
                            <i class="mdi mdi-download"></i>
                            <span>Download for PC VR</span>
                        </a>
                        <a class="btn btn-primary" target="_blank" href="https://github.com/roydejong/BeatSaberServerBrowser/blob/master/README.md">
                            <i class="mdi mdi-book-open-variant"></i>
                            <span>README</span>
                        </a>
                    </div>
                </div>
                <div id="mod-card-quest" class="card" style="width: 375px;">
                    <a class="close mod-card-close" title="Dismiss promo card"><i class="mdi mdi-close"></i></a>
                    <img src="/static/stuff/questserverbrowser.png" class="card-img-top"/>
                    <div class="card-body">
                        <h5 class="card-title">New: Quest port by EnderdracheLP</h5>
                        <ul>
                            <li>Lite version of the server browser</li>
                            <li>Browse and join PC lobbies from Quest</li>
                        </ul>
                        <a class="btn btn-success" target="_blank" href="https://github.com/EnderdracheLP/BeatSaberServerBrowserQuest/releases">
                            <i class="mdi mdi-download"></i>
                            <span>Download for Quest</span>
                        </a>
                        <a class="btn btn-primary" target="_blank" href="https://github.com/EnderdracheLP/BeatSaberServerBrowserQuest/blob/master/README.md">
                            <i class="mdi mdi-book-open-variant"></i>
                            <span>README</span>
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if serverMessage is defined and serverMessage|length > 0 %}
            <div class="alert alert-danger alert-dismissible">
                <h6><i class="mdi mdi-alert"></i> Live notice</h6>
                <span>{{ serverMessage }}</span>
            </div>
        {% endif %}

        {% include "bits/game_query_filters.twig" %}

        {% include "tables/hosted_games_table.twig" %}

    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
$(function () {
    const localStoragePrefix = "dismiss-card-";
    const domPrefix = "mod-card-";
    const cardIds = ["pc", "quest"];
    const cardsParent = $('#mod-cards');

    function dismissCard(cardId) {
        localStorage.setItem(`${localStoragePrefix}${cardId}`, "1");
        $(`#${domPrefix}${cardId}`).hide();
    }

    let anyCardsVisible = false;

    cardIds.forEach(cardId => {
        $(`#${domPrefix}${cardId}`).find('.mod-card-close').click(function (e) {
            e.preventDefault();
            dismissCard(cardId);
            return false;
        });

        if (localStorage.getItem(`${localStoragePrefix}${cardId}`) === "1") {
            dismissCard(cardId);
        } else {
            anyCardsVisible = true;
        }
    });

    cardsParent.show();
});
</script>
{% endblock %}